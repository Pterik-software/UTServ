unit PlansForm;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, Vcl.Buttons, Data.DB,
  MemDS, DBAccess, Uni, Vcl.Grids, Vcl.DBGrids, DBGridEhGrouping, ToolCtrlsEh,
  DBGridEhToolCtrls, DynVarsEh, EhLibVCL, GridsEh, DBAxisGridsEh, DBGridEh;

type
  TFormPlans = class(TForm)
    UniSQLPlans: TUniQuery;
    UniDataSource1: TDataSource;
    BitBtnClose: TBitBtn;
    BitBtnNew: TBitBtn;
    BitBtnDismiss: TBitBtn;
    DBGridEh1: TDBGridEh;
    UniSQLPlansbusiness_id: TStringField;
    UniSQLPlansitem_name: TStringField;
    UniSQLPlanslang_item_name: TStringField;
    UniSQLPlansis_active_locally: TBooleanField;
    UniSQLPlansis_active_server: TBooleanField;
    UniSQLPlansreason_deactivated: TStringField;
    UniSQLPlansupdated_by: TStringField;
    UniSQLPlansupdated_datetime: TDateTimeField;
    UniSQLPlanslog_changes: TStringField;
    UniSQLPlanslng_active_locally: TStringField;
    UniSQLPlanslng_active_server: TStringField;
    procedure DBGridEh1DrawColumnCell(Sender: TObject; const Rect: TRect;
      DataCol: Integer; Column: TColumnEh; State: TGridDrawState);
  private
    { Private declarations }
  public
    procedure SetFormValues;
  end;

var
  FormPlans: TFormPlans;

implementation

{$R *.dfm}

procedure TFormPlans.DBGridEh1DrawColumnCell(Sender: TObject; const Rect: TRect;
  DataCol: Integer; Column: TColumnEh; State: TGridDrawState);
begin
inherited;
  if UniSQLPlans['is_active_locally']=0 then
    TDBGridEh(Sender).Canvas.Brush.Color:= clYellow
  else
    if UniSQLPlans['is_active_server']=0 then
    TDBGridEh(Sender).Canvas.Brush.Color:= clRed
      else TDBGridEh(Sender).Canvas.Brush.Color:= clWhite;
  // Восстанавливаем выделение текущей позиции курсора
  if gdSelected in State then
  begin
    TDBGridEh(Sender).Canvas.Brush.Color:= clHighLight;
    TDBGridEh(Sender).Canvas.Font.Color:= clHighLightText;
  end;
  // Просим GRID перерисоваться самому
  TDBGridEh(Sender).DefaultDrawColumnCell(Rect, DataCol, Column, TGridDrawState(State));
end;

procedure TFormPlans.SetFormValues;
begin
if not UniSQLPlans.Active then UniSQLPlans.Active:=true;
end;

end.
